@model ToDo.Areas.Zadania.ViewModel.TasksVIewConfigModel

@{
    ToDo.Areas.Zadania.Models.Task nameModel = null;
    Layout = "~/Views/Shared/_Layout.cshtml";

    var availableSite = Model.ViewConfig.MultiplierTaskPerSite != 0
        ? Math.Ceiling((decimal)(Model.Tasks.Count() / Model.ViewConfig.TaskPerSite))
        : 1;
}

@{Html.RenderPartial("~/Areas/Zadania/Views/Shared/_PanelView.cshtml");}

<table class="table">
    <thead>
        <tr>
            <td scope="col">@Html.DisplayNameFor(n => nameModel.Action)</td>
            <td scope="col">@Html.DisplayNameFor(n => nameModel.Topic)</td>
            <td scope="col">@Html.DisplayNameFor(n => nameModel.Start)</td>
            <td scope="col">@Html.DisplayNameFor(n => nameModel.End)</td>
            <td scope="col">@Html.DisplayNameFor(n => nameModel.Status)</td>
            <td scope="col">@Html.DisplayNameFor(n => nameModel.Priority)</td>
            <td scope="col">@Html.DisplayNameFor(n => nameModel.Progress)</td>
            <td scope="col"></td>
        </tr>
    </thead>
    <tbody>
        @foreach (var task in Model.Tasks)
        {
            <tr>

                <td scope="col">@Html.DisplayFor(n => task.Action)</td>
                <td scope="col">@Html.DisplayFor(n => task.Topic)</td>
                <td scope="col">@Html.DisplayFor(n => task.Start)</td>
                <td scope="col">@Html.DisplayFor(n => task.End)</td>
                <td scope="col">@Html.DisplayFor(n => task.Status)</td>
                <td scope="col">@Html.DisplayFor(n => task.Priority)</td>
                <td scope="col">@Html.DisplayFor(n => task.Progress)</td>
                <td scope="col">
                    <input type="checkbox" id="selected_@task.Id" onclick="Select(this)">
                    <i class="fab fa-wpforms text-primary small-icon" onclick="Description('@task.Id')"></i>
                    @if (Model.Tasks.First() == task)
                    {
                        <i class="fas fa-angle-up text-primary small-icon-disabled" onclick=""></i>
                    }
                    else
                    {
                        <i class="fas fa-angle-up text-primary small-icon" onclick="PreviousInList('@Url.Action("PreviousInList"))"></i>
                    }
                    @if (Model.Tasks.Last() == task)
                    {
                        <i class="fas fa-angle-down text-primary small-icon-disabled" onclick=""></i>
                    }
                    else
                    {
                        <i class="fas fa-angle-down text-primary small-icon" onclick="NextInList('@Url.Action("NextInList")')"></i>
                    }
                    <i class="fas fa-plus fa-rotate-45 text-danger small-icon" onclick="Delete(@task.Id)"></i>
                </td>
            </tr>
        }
    </tbody>
</table>

<div class="row">
    <div class="text-right">
        <p>
            Elementów na stronie
            <select class="btn" id="viewPerSite" onchange="ChangeElementsPerSite('@Url.Action("ElementsPerSite")')">
                @for (var iterator = 1; iterator <= Model.ViewConfig.MaxMultiplierPerSite; iterator++)
                {
                    int value = iterator * Convert.ToInt32(Model.ViewConfig.BasePerSite);
                    if (value == Model.ViewConfig.TaskPerSite)
                    {
                        <option value="@value" selected="selected">@value</option>
                    }
                    else
                    {
                        <option value="@value">@value</option>
                    }
                }

            </select>
        </p>
    </div>
</div>

<div class="row">
    <div class="text-center">
        @if (Model.ViewConfig.ActualSite == 1)
        {
            <input type="button" value="Poprzedni" class="btn btn-primary" disabled />
        }
        else
        {
            <input type="button" value="Poprzedni" class="btn btn-primary" onclick="PreviousSite('@Url.Action("ActualSite")')" />
        }
        <select class="btn" id="actualSite" onchange="ChangeActualSite('@Url.Action("ActualSite")')">
            @for (var iterator = 1; iterator <= availableSite + 1; iterator++)
            {
                if (iterator == Model.ViewConfig.ActualSite)
                {
                    <option value="@iterator" selected="selected">@iterator</option>
                }
                else
                {
                    <option value="@iterator">@iterator</option>
                }
            }
        </select>

        @if (Model.ViewConfig.ActualSite == availableSite)
        {
            <input type="button" value="Następny" class="btn btn-primary" disabled />
        }
        else
        {
            <input type="button" value="Następny" class="btn btn-primary" onclick="NextSite('@Url.Action("ActualSite")')" />
        }
    </div>
</div>

<div id="popup" style="display: none;">
    <div id="AddPopUp">
        @{ Html.RenderPartial("~/Areas/Zadania/Views/Shared/_CreateTask.cshtml", new ToDo.Areas.Zadania.Models.Task()); }
    </div>
    <div id="EditPopUp">

    </div>
    <div id="DescriptionPopUp">
        @if (Model.ViewConfig.DescriptionTaskId > 0)
        {
            Html.RenderPartial("~/Areas/Zadania/Views/Shared/_DescriptionView.cshtml", Model.Tasks.FirstOrDefault(t => t.Id == Model.ViewConfig.DescriptionTaskId));
        }
    </div>
</div>

<div id="Error" style="display: none;"></div>
<div id="DeleteModal" style="display: none;">Czy na pewno chcesz usunąć to zadanie?</div>
@Model.ViewConfig.VisibleModal
@Model.ViewConfig.DescriptionTaskId
<script type="text/javascript">
    const Description = function (id) {
        location.href = `@Url.Action("Description", "Zadanie")/${id}`;

    }

    const Delete = function (id) {
        $('#DeleteModal').dialog({
            autoOpen: true,
            title: 'Potwierdzenie',
            modal: true,
            hide: 'clip',
            show: 'shake',
            buttons: [
                {
                    text: "OK",
                    click: function () {
                        @{ 
                            <text>
                        location.href = `@Url.Action("Delete", "Zadanie")/${id}`;
                            </text>
                        }
                    }
                },
                {
                    text: "Anuluj",
                    click: function () {
                        $(this).dialog('close');
                    }
                }]
        });
    }

    @{
        <text>
    const LoadModalWindow = function () {
        PopUp.OpenDialog('@Model.ViewConfig.VisibleModal');
    };

    if (window.addEventListener) {
        window.addEventListener('load', LoadModalWindow, false);
    }
    else if (window.attachEvent) {
        window.attachEvent('onload', LoadModalWindow);
    }

        </text>
    }
</script>

@if (Model.Exception != String.Empty && Model.Exception != null)
{
    Html.RenderPartial("~/Areas/Zadania/Views/Shared/_ExceptionHandle.cshtml", Model.Exception);
}

